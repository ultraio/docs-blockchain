import{_ as t,c as e,o as a,N as i}from"./chunks/framework.qSInOY95.js";const m=JSON.parse('{"title":"AOM Mining Contract","description":"","frontmatter":{"title":"AOM Mining Contract","order":101},"headers":[],"relativePath":"blockchain/contracts/aom-contracts/aom-mining.md","filePath":"blockchain/contracts/aom-contracts/aom-mining.md","lastUpdated":null}'),s={name:"blockchain/contracts/aom-contracts/aom-mining.md"},o=i('<h1 id="aom-mining-contract-aom-mining" tabindex="-1">AOM Mining Contract (aom.mining) <a class="header-anchor" href="#aom-mining-contract-aom-mining" aria-label="Permalink to &quot;AOM Mining Contract (aom.mining)&quot;">​</a></h1><p>The AOM Mining contract manages resource prospecting, mining operations, and mine upgrades within the Ash of Mankind ecosystem. This contract handles the discovery of natural resources on land parcels and their subsequent extraction through built mines.</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>The mining contract enables players to:</p><ul><li>Prospect unbuilt resource land to discover natural resources</li><li>Build and operate mines to extract resources over time</li><li>Upgrade mine production speed and storage capacity</li><li>Collect accumulated resources from active mines</li></ul><h2 id="tables" tabindex="-1">Tables <a class="header-anchor" href="#tables" aria-label="Permalink to &quot;Tables&quot;">​</a></h2><h3 id="global-settings" tabindex="-1">Global Settings <a class="header-anchor" href="#global-settings" aria-label="Permalink to &quot;Global Settings&quot;">​</a></h3><h4 id="global-singleton" tabindex="-1"><code>global</code> (Singleton) <a class="header-anchor" href="#global-singleton" aria-label="Permalink to &quot;`global` (Singleton)&quot;">​</a></h4><ul><li><strong>Scope</strong>: Contract (<code>aom.mining</code>)</li><li><strong>Description</strong>: Global contract state</li></ul><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>locked</code></td><td><code>bool</code></td><td>Emergency lock status</td></tr></tbody></table><h4 id="basesettings-singleton" tabindex="-1"><code>basesettings</code> (Singleton) <a class="header-anchor" href="#basesettings-singleton" aria-label="Permalink to &quot;`basesettings` (Singleton)&quot;">​</a></h4><ul><li><strong>Scope</strong>: Contract (<code>aom.mining</code>)</li><li><strong>Description</strong>: Base mining configuration</li></ul><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>prospecting_duration_sec</code></td><td><code>uint32_t</code></td><td>Seconds required for prospecting</td></tr><tr><td><code>instant_prospecting_fee</code></td><td><code>map&lt;symbol, uint64_t&gt;</code></td><td>Fees for instant prospecting</td></tr><tr><td><code>upgrade_production_speed_fee</code></td><td><code>map&lt;symbol, uint64_t&gt;</code></td><td>Fees for production speed upgrades</td></tr><tr><td><code>upgrade_storage_capacity_fee</code></td><td><code>map&lt;symbol, uint64_t&gt;</code></td><td>Fees for storage capacity upgrades</td></tr><tr><td><code>valid_resource_land_factory_ids</code></td><td><code>vector&lt;uint64_t&gt;</code></td><td>Valid factory IDs for resource land</td></tr></tbody></table><h4 id="resourcestng-multi-index" tabindex="-1"><code>resourcestng</code> (Multi-Index) <a class="header-anchor" href="#resourcestng-multi-index" aria-label="Permalink to &quot;`resourcestng` (Multi-Index)&quot;">​</a></h4><ul><li><strong>Scope</strong>: Contract (<code>aom.mining</code>)</li><li><strong>Primary Key</strong>: <code>resource_symbol.code().raw()</code></li><li><strong>Secondary Index</strong>: <code>type</code> (by <code>resource_type</code>)</li></ul><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>resource_symbol</code></td><td><code>symbol</code></td><td>Token symbol for this resource</td></tr><tr><td><code>resource_type</code></td><td><code>string</code></td><td>Resource type name (e.g., &quot;Iron&quot;, &quot;Coal&quot;)</td></tr><tr><td><code>to_be_prospected</code></td><td><code>uint64_t</code></td><td>Remaining prospectable quantity</td></tr><tr><td><code>min_droprate_qty</code></td><td><code>uint64_t</code></td><td>Minimum quantity when found</td></tr><tr><td><code>max_droprate_qty</code></td><td><code>uint64_t</code></td><td>Maximum quantity when found</td></tr><tr><td><code>base_daily_mining_qty</code></td><td><code>uint64_t</code></td><td>Base daily production rate</td></tr><tr><td><code>base_storage_qty</code></td><td><code>uint64_t</code></td><td>Base storage capacity</td></tr><tr><td><code>max_storage_qty</code></td><td><code>uint64_t</code></td><td>Maximum storage capacity</td></tr><tr><td><code>production_speed_upgrade_increment</code></td><td><code>uint64_t</code></td><td>Production speed increase per upgrade (precision: 2)</td></tr><tr><td><code>max_production_speed</code></td><td><code>uint64_t</code></td><td>Maximum production speed (precision: 2)</td></tr></tbody></table><h3 id="operational-tables" tabindex="-1">Operational Tables <a class="header-anchor" href="#operational-tables" aria-label="Permalink to &quot;Operational Tables&quot;">​</a></h3><h4 id="prospecttime-multi-index" tabindex="-1"><code>prospecttime</code> (Multi-Index) <a class="header-anchor" href="#prospecttime-multi-index" aria-label="Permalink to &quot;`prospecttime` (Multi-Index)&quot;">​</a></h4><ul><li><strong>Scope</strong>: Contract (<code>aom.mining</code>)</li><li><strong>Primary Key</strong>: <code>uniq_id</code></li></ul><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>uniq_id</code></td><td><code>uint64_t</code></td><td>Uniq being prospected</td></tr><tr><td><code>completion_block_time</code></td><td><code>uint32_t</code></td><td>When prospecting completes</td></tr></tbody></table><h4 id="cllctngtime-multi-index" tabindex="-1"><code>cllctngtime</code> (Multi-Index) <a class="header-anchor" href="#cllctngtime-multi-index" aria-label="Permalink to &quot;`cllctngtime` (Multi-Index)&quot;">​</a></h4><ul><li><strong>Scope</strong>: Contract (<code>aom.mining</code>)</li><li><strong>Primary Key</strong>: <code>uniq_id</code></li></ul><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>uniq_id</code></td><td><code>uint64_t</code></td><td>Mine Uniq ID</td></tr><tr><td><code>last_collected</code></td><td><code>uint32_t</code></td><td>Last collection timestamp</td></tr></tbody></table><h4 id="rngrequests-multi-index" tabindex="-1"><code>rngrequests</code> (Multi-Index) <a class="header-anchor" href="#rngrequests-multi-index" aria-label="Permalink to &quot;`rngrequests` (Multi-Index)&quot;">​</a></h4><ul><li><strong>Scope</strong>: Contract (<code>aom.mining</code>)</li><li><strong>Primary Key</strong>: <code>assoc_id</code></li></ul><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>assoc_id</code></td><td><code>uint64_t</code></td><td>RNG request association ID</td></tr><tr><td><code>uniq_id</code></td><td><code>uint64_t</code></td><td>Uniq being prospected</td></tr><tr><td><code>uniq_owner</code></td><td><code>name</code></td><td>Owner of the Uniq</td></tr></tbody></table><h4 id="feebuffer-singleton" tabindex="-1"><code>feebuffer</code> (Singleton) <a class="header-anchor" href="#feebuffer-singleton" aria-label="Permalink to &quot;`feebuffer` (Singleton)&quot;">​</a></h4><ul><li><strong>Scope</strong>: User account</li><li><strong>Description</strong>: Buffered fees for multi-asset payments</li></ul><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>action_type</code></td><td><code>string</code></td><td>Type of action being paid for</td></tr><tr><td><code>total_num</code></td><td><code>uint64_t</code></td><td>Total number of upgrades</td></tr><tr><td><code>fee</code></td><td><code>map&lt;symbol, uint64_t&gt;</code></td><td>Accumulated fees by asset</td></tr></tbody></table><h2 id="actions" tabindex="-1">Actions <a class="header-anchor" href="#actions" aria-label="Permalink to &quot;Actions&quot;">​</a></h2><h3 id="administrative-actions" tabindex="-1">Administrative Actions <a class="header-anchor" href="#administrative-actions" aria-label="Permalink to &quot;Administrative Actions&quot;">​</a></h3><h4 id="updbasesttng" tabindex="-1"><code>updbasesttng</code> <a class="header-anchor" href="#updbasesttng" aria-label="Permalink to &quot;`updbasesttng`&quot;">​</a></h4><p>Updates base mining settings.</p><p><strong>Authorization</strong>: Contract (<code>aom.mining</code>)</p><p><strong>Parameters</strong>:</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>row</code></td><td><code>mining_base_settings</code></td><td>New base settings</td></tr></tbody></table><p><strong>Behavior</strong>: Sets global mining parameters including prospecting duration and upgrade fees.</p><p><strong>CLI Example</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cleos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.mining</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> updbasesttng</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;row&quot;: {&quot;prospecting_duration_sec&quot;: 86400, &quot;instant_prospecting_fee&quot;: [[&quot;4,ASH&quot;, 1000]], &quot;upgrade_production_speed_fee&quot;: [[&quot;4,ASH&quot;, 500]], &quot;upgrade_storage_capacity_fee&quot;: [[&quot;4,ASH&quot;, 300]], &quot;valid_resource_land_factory_ids&quot;: [123, 124, 125]}}&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.mining@active</span></span></code></pre></div><h4 id="updrsrcsttng" tabindex="-1"><code>updrsrcsttng</code> <a class="header-anchor" href="#updrsrcsttng" aria-label="Permalink to &quot;`updrsrcsttng`&quot;">​</a></h4><p>Updates resource-specific settings.</p><p><strong>Authorization</strong>: Contract (<code>aom.mining</code>)</p><p><strong>Parameters</strong>:</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>row</code></td><td><code>mining_resource_settings</code></td><td>Resource configuration</td></tr></tbody></table><p><strong>Behavior</strong>: Configures parameters for a specific resource type including drop rates and production values.</p><p><strong>CLI Example</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cleos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.mining</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> updrsrcsttng</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;row&quot;: {&quot;resource_symbol&quot;: &quot;4,IRON&quot;, &quot;resource_type&quot;: &quot;Iron&quot;, &quot;to_be_prospected&quot;: 1000, &quot;min_droprate_qty&quot;: 100, &quot;max_droprate_qty&quot;: 500, &quot;base_daily_mining_qty&quot;: 50, &quot;base_storage_qty&quot;: 1000, &quot;max_storage_qty&quot;: 10000, &quot;production_speed_upgrade_increment&quot;: 25, &quot;max_production_speed&quot;: 500}}&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.mining@active</span></span></code></pre></div><h4 id="setlocked" tabindex="-1"><code>setlocked</code> <a class="header-anchor" href="#setlocked" aria-label="Permalink to &quot;`setlocked`&quot;">​</a></h4><p>Emergency lock/unlock the contract.</p><p><strong>Authorization</strong>: Contract (<code>aom.mining</code>)</p><p><strong>Parameters</strong>:</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>locked</code></td><td><code>bool</code></td><td>Lock status</td></tr></tbody></table><p><strong>CLI Example</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cleos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.mining</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> setlocked</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;locked&quot;: true}&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.mining@active</span></span></code></pre></div><h3 id="gameplay-actions" tabindex="-1">Gameplay Actions <a class="header-anchor" href="#gameplay-actions" aria-label="Permalink to &quot;Gameplay Actions&quot;">​</a></h3><h4 id="strtprspctng" tabindex="-1"><code>strtprspctng</code> <a class="header-anchor" href="#strtprspctng" aria-label="Permalink to &quot;`strtprspctng`&quot;">​</a></h4><p>Initiates prospecting on unbuilt resource land.</p><p><strong>Authorization</strong>: Uniq owner</p><p><strong>Parameters</strong>:</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>uniq_owner</code></td><td><code>name</code></td><td>Owner of the land Uniq</td></tr><tr><td><code>uniq_id</code></td><td><code>uint64_t</code></td><td>Land Uniq to prospect</td></tr></tbody></table><p><strong>Behavior</strong>:</p><ul><li>Validates land is unbuilt resource land from valid factory</li><li>Creates prospecting timer entry</li><li>Updates land metadata to &quot;Unfinished Prospection&quot;</li></ul><p><strong>Technical Requirements</strong>:</p><ul><li>Land must have no key_values set (unbuilt state)</li><li>Factory must have correct 5-key schema with proper defaults</li><li>Land cannot already be under prospecting</li></ul><p><strong>CLI Example</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cleos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.mining</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> strtprspctng</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;uniq_owner&quot;: &quot;alice&quot;, &quot;uniq_id&quot;: 12345}&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> alice@active</span></span></code></pre></div><h4 id="reqprspctrep" tabindex="-1"><code>reqprspctrep</code> <a class="header-anchor" href="#reqprspctrep" aria-label="Permalink to &quot;`reqprspctrep`&quot;">​</a></h4><p>Requests prospecting completion with randomness.</p><p><strong>Authorization</strong>: Uniq owner</p><p><strong>Parameters</strong>:</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>uniq_owner</code></td><td><code>name</code></td><td>Owner of the land Uniq</td></tr><tr><td><code>uniq_id</code></td><td><code>uint64_t</code></td><td>Land Uniq being prospected</td></tr><tr><td><code>seed</code></td><td><code>uint64_t</code></td><td>Random seed value</td></tr></tbody></table><p><strong>Behavior</strong>:</p><ul><li>Validates prospecting is complete (time elapsed)</li><li>Requests random number from Ultra RNG service</li><li>Removes prospecting timer entry</li></ul><p><strong>CLI Example</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cleos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.mining</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reqprspctrep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;uniq_owner&quot;: &quot;alice&quot;, &quot;uniq_id&quot;: 12345, &quot;seed&quot;: 987654321}&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> alice@active</span></span></code></pre></div><h4 id="receiverand" tabindex="-1"><code>receiverand</code> <a class="header-anchor" href="#receiverand" aria-label="Permalink to &quot;`receiverand`&quot;">​</a></h4><p>Receives random number and completes prospecting.</p><p><strong>Authorization</strong>: <code>ultra.rng</code> (RNG service)</p><p><strong>Parameters</strong>:</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>assoc_id</code></td><td><code>uint64_t</code></td><td>RNG request association ID</td></tr><tr><td><code>random_value</code></td><td><code>uint64_t</code></td><td>Generated random number</td></tr></tbody></table><p><strong>Behavior</strong>:</p><ul><li>Uses random value to determine resource type and quantity</li><li>Updates land metadata with discovered resource</li><li>Decrements available resources in settings</li><li>Updates land JSON metadata</li></ul><p><strong>Note</strong>: This action is called automatically by the RNG service.</p><h4 id="collectrsrcs" tabindex="-1"><code>collectrsrcs</code> <a class="header-anchor" href="#collectrsrcs" aria-label="Permalink to &quot;`collectrsrcs`&quot;">​</a></h4><p>Collects accumulated resources from a mine.</p><p><strong>Authorization</strong>: Uniq owner</p><p><strong>Parameters</strong>:</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>uniq_owner</code></td><td><code>name</code></td><td>Owner of the mine Uniq</td></tr><tr><td><code>uniq_id</code></td><td><code>uint64_t</code></td><td>Mine Uniq ID</td></tr></tbody></table><p><strong>Behavior</strong>:</p><ul><li>Calculates resources produced since last collection</li><li>Issues resource tokens to owner</li><li>Updates mine&#39;s remaining resources</li><li>Records new collection timestamp</li></ul><p><strong>Production Formula</strong>:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">produced_amount </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (time_elapsed </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> base_daily_mining_qty </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> production_speed </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 86400</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">produced_amount </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(produced_amount, remaining_resources)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">produced_amount </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(produced_amount, storage_capacity)</span></span></code></pre></div><p><strong>CLI Example</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cleos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.mining</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> collectrsrcs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;uniq_owner&quot;: &quot;alice&quot;, &quot;uniq_id&quot;: 12345}&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> alice@active</span></span></code></pre></div><h4 id="clearbuffer" tabindex="-1"><code>clearbuffer</code> <a class="header-anchor" href="#clearbuffer" aria-label="Permalink to &quot;`clearbuffer`&quot;">​</a></h4><p>Clears fee buffer and refunds assets.</p><p><strong>Authorization</strong>: User</p><p><strong>Parameters</strong>:</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>user</code></td><td><code>name</code></td><td>User to clear buffer for</td></tr></tbody></table><p><strong>CLI Example</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cleos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.mining</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clearbuffer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;user&quot;: &quot;alice&quot;}&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> alice@active</span></span></code></pre></div><h3 id="internal-actions" tabindex="-1">Internal Actions <a class="header-anchor" href="#internal-actions" aria-label="Permalink to &quot;Internal Actions&quot;">​</a></h3><h4 id="minebuilt" tabindex="-1"><code>minebuilt</code> <a class="header-anchor" href="#minebuilt" aria-label="Permalink to &quot;`minebuilt`&quot;">​</a></h4><p>Called by construction contract when a mine is built.</p><p><strong>Authorization</strong>: <code>aom.constrct</code></p><p><strong>Parameters</strong>:</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>uniq_id</code></td><td><code>uint64_t</code></td><td>Newly built mine ID</td></tr></tbody></table><p><strong>Behavior</strong>: Creates initial collection timer entry for the new mine.</p><h2 id="token-transfer-actions" tabindex="-1">Token Transfer Actions <a class="header-anchor" href="#token-transfer-actions" aria-label="Permalink to &quot;Token Transfer Actions&quot;">​</a></h2><p>The contract accepts token transfers for various upgrade operations through the <code>on_transfer</code> notification.</p><h3 id="instant-prospecting" tabindex="-1">Instant Prospecting <a class="header-anchor" href="#instant-prospecting" aria-label="Permalink to &quot;Instant Prospecting&quot;">​</a></h3><p><strong>Memo Format</strong>: <code>InstantProspect[,&lt;uniq_id&gt;]</code></p><p>Send required fees to instantly complete prospecting for a land parcel.</p><h3 id="production-speed-upgrade" tabindex="-1">Production Speed Upgrade <a class="header-anchor" href="#production-speed-upgrade" aria-label="Permalink to &quot;Production Speed Upgrade&quot;">​</a></h3><p><strong>Memo Format</strong>: <code>UpgradeProductionSpeed[,&lt;uniq_id&gt;]</code></p><p>Send fees to upgrade a mine&#39;s production speed. Multiple upgrades can be purchased with proportional fees.</p><h3 id="storage-capacity-upgrade" tabindex="-1">Storage Capacity Upgrade <a class="header-anchor" href="#storage-capacity-upgrade" aria-label="Permalink to &quot;Storage Capacity Upgrade&quot;">​</a></h3><p><strong>Memo Format</strong>: <code>UpgradeStorageCapacity[,&lt;uniq_id&gt;]</code></p><p>Send fees to upgrade a mine&#39;s storage capacity. Multiple upgrades can be purchased with proportional fees.</p><h2 id="integration-with-on-chain-data" tabindex="-1">Integration with On-Chain Data <a class="header-anchor" href="#integration-with-on-chain-data" aria-label="Permalink to &quot;Integration with On-Chain Data&quot;">​</a></h2><p>The mining contract extensively uses Ultra&#39;s on-chain data system to manage land state:</p><h3 id="factory-schema-requirements" tabindex="-1">Factory Schema Requirements <a class="header-anchor" href="#factory-schema-requirements" aria-label="Permalink to &quot;Factory Schema Requirements&quot;">​</a></h3><p>Resource land factories must have exactly 5 keys:</p><ol><li><strong>BuildingType</strong> (string) - Default: &quot;Unbuilt&quot;</li><li><strong>ResourceType</strong> (string) - Default: &quot;Unprospected&quot;</li><li><strong>ResourceQty</strong> (uint64)</li><li><strong>ProductionSpeed</strong> (uint64)</li><li><strong>StorageCapacity</strong> (uint64)</li></ol><h3 id="state-transitions" tabindex="-1">State Transitions <a class="header-anchor" href="#state-transitions" aria-label="Permalink to &quot;State Transitions&quot;">​</a></h3><p>Land parcels progress through these states:</p><ol><li><strong>Unbuilt</strong> → <strong>Unfinished Prospection</strong> (prospecting started)</li><li><strong>Unfinished Prospection</strong> → <strong>Unbuilt</strong> + ResourceType (prospecting completed)</li><li><strong>Unbuilt</strong> → <strong>Mine</strong> (construction completed)</li></ol><h3 id="metadata-updates" tabindex="-1">Metadata Updates <a class="header-anchor" href="#metadata-updates" aria-label="Permalink to &quot;Metadata Updates&quot;">​</a></h3><p>The contract updates both on-chain key-value data and JSON metadata to maintain consistency between game state and display assets.</p><h2 id="security-considerations" tabindex="-1">Security Considerations <a class="header-anchor" href="#security-considerations" aria-label="Permalink to &quot;Security Considerations&quot;">​</a></h2><ul><li><strong>Ownership Validation</strong>: All operations validate Uniq ownership</li><li><strong>State Consistency</strong>: Extensive validation prevents invalid state transitions</li><li><strong>Random Number Security</strong>: Uses Ultra&#39;s secure RNG service</li><li><strong>Fee Validation</strong>: Robust checks prevent fee manipulation</li><li><strong>Emergency Controls</strong>: Contract locking mechanism for emergencies</li></ul>',131),n=[o];function r(d,c,l,p,h,u){return a(),e("div",null,n)}const k=t(s,[["render",r]]);export{m as __pageData,k as default};
