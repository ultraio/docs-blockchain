import{_ as t,c as a,o as i,N as s}from"./chunks/framework.qSInOY95.js";const k=JSON.parse('{"title":"AOM Construction Contract","description":"","frontmatter":{"title":"AOM Construction Contract","order":102},"headers":[],"relativePath":"blockchain/contracts/aom-contracts/aom-construction.md","filePath":"blockchain/contracts/aom-contracts/aom-construction.md","lastUpdated":null}'),e={name:"blockchain/contracts/aom-contracts/aom-construction.md"},n=s('<h1 id="aom-construction-contract-aom-constrct" tabindex="-1">AOM Construction Contract (aom.constrct) <a class="header-anchor" href="#aom-construction-contract-aom-constrct" aria-label="Permalink to &quot;AOM Construction Contract (aom.constrct)&quot;">​</a></h1><p>The AOM Construction contract manages building construction on land parcels within the Ash of Mankind ecosystem. This contract handles the creation of various structures including mines, factories, and other buildings on both resource and construction land.</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>The construction contract enables players to:</p><ul><li>Build structures on prospected resource land and construction land</li><li>Manage construction timers and completion</li><li>Handle instant construction for premium fees</li><li>Update land metadata and visual assets upon completion</li></ul><h2 id="tables" tabindex="-1">Tables <a class="header-anchor" href="#tables" aria-label="Permalink to &quot;Tables&quot;">​</a></h2><h3 id="configuration-tables" tabindex="-1">Configuration Tables <a class="header-anchor" href="#configuration-tables" aria-label="Permalink to &quot;Configuration Tables&quot;">​</a></h3><h4 id="global-singleton" tabindex="-1"><code>global</code> (Singleton) <a class="header-anchor" href="#global-singleton" aria-label="Permalink to &quot;`global` (Singleton)&quot;">​</a></h4><ul><li><strong>Scope</strong>: Contract (<code>aom.constrct</code>)</li><li><strong>Description</strong>: Global contract state</li></ul><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>locked</code></td><td><code>bool</code></td><td>Emergency lock status</td></tr></tbody></table><h4 id="basesettings-singleton" tabindex="-1"><code>basesettings</code> (Singleton) <a class="header-anchor" href="#basesettings-singleton" aria-label="Permalink to &quot;`basesettings` (Singleton)&quot;">​</a></h4><ul><li><strong>Scope</strong>: Contract (<code>aom.constrct</code>)</li><li><strong>Description</strong>: Base construction configuration</li></ul><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>valid_construction_land_factory_ids</code></td><td><code>vector&lt;uint64_t&gt;</code></td><td>Valid factory IDs for construction land</td></tr></tbody></table><h4 id="cnstrcsttngs-multi-index" tabindex="-1"><code>cnstrcsttngs</code> (Multi-Index) <a class="header-anchor" href="#cnstrcsttngs-multi-index" aria-label="Permalink to &quot;`cnstrcsttngs` (Multi-Index)&quot;">​</a></h4><ul><li><strong>Scope</strong>: Contract (<code>aom.constrct</code>)</li><li><strong>Primary Key</strong>: <code>string_idx(building_type)</code></li></ul><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>building_type</code></td><td><code>string</code></td><td>Type of building (e.g., &quot;Mine&quot;, &quot;Factory&quot;)</td></tr><tr><td><code>required_factory_id</code></td><td><code>uint64_t</code></td><td>Required land factory ID</td></tr><tr><td><code>construction_duration_sec</code></td><td><code>uint32_t</code></td><td>Construction time in seconds</td></tr><tr><td><code>building_fee</code></td><td><code>map&lt;symbol, uint64_t&gt;</code></td><td>Required fees for construction</td></tr><tr><td><code>instant_construction_fee</code></td><td><code>map&lt;symbol, uint64_t&gt;</code></td><td>Fees for instant completion</td></tr></tbody></table><h4 id="metadata-multi-index" tabindex="-1"><code>metadata</code> (Multi-Index) <a class="header-anchor" href="#metadata-multi-index" aria-label="Permalink to &quot;`metadata` (Multi-Index)&quot;">​</a></h4><ul><li><strong>Scope</strong>: Contract (<code>aom.constrct</code>)</li><li><strong>Primary Key</strong>: <code>string_idx(land_state)</code></li></ul><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>land_state</code></td><td><code>string</code></td><td>Land state identifier</td></tr><tr><td><code>metadata_url</code></td><td><code>string</code></td><td>JSON metadata URL</td></tr><tr><td><code>metadata_hash</code></td><td><code>checksum256</code></td><td>Metadata content hash</td></tr></tbody></table><h3 id="operational-tables" tabindex="-1">Operational Tables <a class="header-anchor" href="#operational-tables" aria-label="Permalink to &quot;Operational Tables&quot;">​</a></h3><h4 id="construction-multi-index" tabindex="-1"><code>construction</code> (Multi-Index) <a class="header-anchor" href="#construction-multi-index" aria-label="Permalink to &quot;`construction` (Multi-Index)&quot;">​</a></h4><ul><li><strong>Scope</strong>: Contract (<code>aom.constrct</code>)</li><li><strong>Primary Key</strong>: <code>uniq_id</code></li></ul><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>uniq_id</code></td><td><code>uint64_t</code></td><td>Uniq under construction</td></tr><tr><td><code>building_type</code></td><td><code>string</code></td><td>Type of building being constructed</td></tr><tr><td><code>completion_block_time</code></td><td><code>uint32_t</code></td><td>When construction completes</td></tr></tbody></table><h4 id="feebuffer-singleton" tabindex="-1"><code>feebuffer</code> (Singleton) <a class="header-anchor" href="#feebuffer-singleton" aria-label="Permalink to &quot;`feebuffer` (Singleton)&quot;">​</a></h4><ul><li><strong>Scope</strong>: User account</li><li><strong>Description</strong>: Buffered fees for multi-asset payments</li></ul><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>building_type</code></td><td><code>string</code></td><td>Type of building being paid for</td></tr><tr><td><code>fee</code></td><td><code>map&lt;symbol, uint64_t&gt;</code></td><td>Accumulated fees by asset</td></tr></tbody></table><h2 id="actions" tabindex="-1">Actions <a class="header-anchor" href="#actions" aria-label="Permalink to &quot;Actions&quot;">​</a></h2><h3 id="administrative-actions" tabindex="-1">Administrative Actions <a class="header-anchor" href="#administrative-actions" aria-label="Permalink to &quot;Administrative Actions&quot;">​</a></h3><h4 id="updbasesttng" tabindex="-1"><code>updbasesttng</code> <a class="header-anchor" href="#updbasesttng" aria-label="Permalink to &quot;`updbasesttng`&quot;">​</a></h4><p>Updates base construction settings.</p><p><strong>Authorization</strong>: Contract (<code>aom.constrct</code>)</p><p><strong>Parameters</strong>:</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>row</code></td><td><code>construction_base_settings</code></td><td>New base settings</td></tr></tbody></table><p><strong>Behavior</strong>: Sets valid construction land factory IDs.</p><p><strong>CLI Example</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cleos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.constrct</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> updbasesttng</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;row&quot;: {&quot;valid_construction_land_factory_ids&quot;: [200, 201, 202]}}&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.constrct@active</span></span></code></pre></div><h4 id="updcnststtng" tabindex="-1"><code>updcnststtng</code> <a class="header-anchor" href="#updcnststtng" aria-label="Permalink to &quot;`updcnststtng`&quot;">​</a></h4><p>Updates construction settings for a building type.</p><p><strong>Authorization</strong>: Contract (<code>aom.constrct</code>)</p><p><strong>Parameters</strong>:</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>row</code></td><td><code>construction_settings</code></td><td>Building configuration</td></tr></tbody></table><p><strong>Behavior</strong>: Configures construction parameters for a specific building type.</p><p><strong>CLI Example</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cleos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.constrct</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> updcnststtng</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;row&quot;: {&quot;building_type&quot;: &quot;Mine&quot;, &quot;required_factory_id&quot;: 123, &quot;construction_duration_sec&quot;: 3600, &quot;building_fee&quot;: [[&quot;4,ASH&quot;, 1000], [&quot;4,IRON&quot;, 500]], &quot;instant_construction_fee&quot;: [[&quot;4,ASH&quot;, 5000]]}}&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.constrct@active</span></span></code></pre></div><h4 id="updmetadata" tabindex="-1"><code>updmetadata</code> <a class="header-anchor" href="#updmetadata" aria-label="Permalink to &quot;`updmetadata`&quot;">​</a></h4><p>Updates metadata mapping for land states.</p><p><strong>Authorization</strong>: Contract (<code>aom.constrct</code>)</p><p><strong>Parameters</strong>:</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>row</code></td><td><code>metadata</code></td><td>Metadata configuration</td></tr></tbody></table><p><strong>Behavior</strong>: Maps land states to their corresponding JSON metadata URLs and hashes.</p><p><strong>CLI Example</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cleos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.constrct</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> updmetadata</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;row&quot;: {&quot;land_state&quot;: &quot;ResourceLandIronMine&quot;, &quot;metadata_url&quot;: &quot;https://example.com/iron-mine.json&quot;, &quot;metadata_hash&quot;: &quot;abc123...&quot;}}&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.constrct@active</span></span></code></pre></div><h4 id="setlocked" tabindex="-1"><code>setlocked</code> <a class="header-anchor" href="#setlocked" aria-label="Permalink to &quot;`setlocked`&quot;">​</a></h4><p>Emergency lock/unlock the contract.</p><p><strong>Authorization</strong>: Contract (<code>aom.constrct</code>)</p><p><strong>Parameters</strong>:</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>locked</code></td><td><code>bool</code></td><td>Lock status</td></tr></tbody></table><p><strong>CLI Example</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cleos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.constrct</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> setlocked</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;locked&quot;: true}&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.constrct@active</span></span></code></pre></div><h3 id="gameplay-actions" tabindex="-1">Gameplay Actions <a class="header-anchor" href="#gameplay-actions" aria-label="Permalink to &quot;Gameplay Actions&quot;">​</a></h3><h4 id="cutribbon" tabindex="-1"><code>cutribbon</code> <a class="header-anchor" href="#cutribbon" aria-label="Permalink to &quot;`cutribbon`&quot;">​</a></h4><p>Completes construction of a building.</p><p><strong>Authorization</strong>: Uniq owner</p><p><strong>Parameters</strong>:</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>uniq_id</code></td><td><code>uint64_t</code></td><td>Uniq to complete construction for</td></tr><tr><td><code>uniq_owner</code></td><td><code>name</code></td><td>Owner of the Uniq</td></tr></tbody></table><p><strong>Behavior</strong>:</p><ul><li>Validates construction is complete (time elapsed)</li><li>Updates land metadata with final building type</li><li>Sets initial building parameters (production speed, storage)</li><li>Updates JSON metadata for visual representation</li><li>Removes construction timer entry</li></ul><p><strong>Special Handling for Mines</strong>:</p><ul><li>Calls <code>aom.mining::minebuilt</code> to initialize collection timer</li><li>Sets storage capacity based on resource type settings</li><li>Updates metadata key format for resource-specific buildings</li></ul><p><strong>CLI Example</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cleos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.constrct</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cutribbon</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;uniq_id&quot;: 12345, &quot;uniq_owner&quot;: &quot;alice&quot;}&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> alice@active</span></span></code></pre></div><h4 id="clearbuffer" tabindex="-1"><code>clearbuffer</code> <a class="header-anchor" href="#clearbuffer" aria-label="Permalink to &quot;`clearbuffer`&quot;">​</a></h4><p>Clears fee buffer and refunds assets.</p><p><strong>Authorization</strong>: User</p><p><strong>Parameters</strong>:</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>user</code></td><td><code>name</code></td><td>User to clear buffer for</td></tr></tbody></table><p><strong>CLI Example</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cleos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> action</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.constrct</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clearbuffer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;user&quot;: &quot;alice&quot;}&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> alice@active</span></span></code></pre></div><h2 id="token-transfer-actions" tabindex="-1">Token Transfer Actions <a class="header-anchor" href="#token-transfer-actions" aria-label="Permalink to &quot;Token Transfer Actions&quot;">​</a></h2><p>The contract accepts token transfers for construction operations through the <code>on_transfer</code> notification.</p><h3 id="building-construction" tabindex="-1">Building Construction <a class="header-anchor" href="#building-construction" aria-label="Permalink to &quot;Building Construction&quot;">​</a></h3><p><strong>Memo Format</strong>: <code>Build,&lt;building_type&gt;[,&lt;uniq_id&gt;]</code></p><p><strong>Two-Phase Process</strong>:</p><ol><li><strong>Fee Collection</strong>: Send required assets without uniq_id to accumulate fees</li><li><strong>Construction Start</strong>: Send final asset with uniq_id to begin construction</li></ol><p><strong>Validation</strong>:</p><ul><li>Land must be from correct factory for building type</li><li>Land must be in appropriate state (unbuilt or prospected)</li><li>All required fees must be paid</li></ul><p><strong>Examples</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Phase 1: Send ASH tokens</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cleos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> transfer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> alice</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.constrct</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;1000.0000 ASH&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Build,Mine&quot;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Phase 2: Send IRON tokens and start construction</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cleos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> transfer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> alice</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.constrct</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;500.0000 IRON&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Build,Mine,12345&quot;</span></span></code></pre></div><h3 id="instant-construction" tabindex="-1">Instant Construction <a class="header-anchor" href="#instant-construction" aria-label="Permalink to &quot;Instant Construction&quot;">​</a></h3><p><strong>Memo Format</strong>: <code>InstantConstruction,&lt;building_type&gt;[,&lt;uniq_id&gt;]</code></p><p><strong>Two-Phase Process</strong>:</p><ol><li><strong>Fee Collection</strong>: Send required assets without uniq_id</li><li><strong>Instant Completion</strong>: Send final asset with uniq_id to instantly complete</li></ol><p><strong>Behavior</strong>:</p><ul><li>Sets completion time to current block time</li><li>Allows immediate <code>cutribbon</code> call</li></ul><p><strong>Examples</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Phase 1: Send instant construction fees</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cleos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> transfer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> alice</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.constrct</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;5000.0000 ASH&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;InstantConstruction,Mine&quot;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Phase 2: Complete instantly</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cleos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> transfer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> alice</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aom.constrct</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;0.0001 ASH&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;InstantConstruction,Mine,12345&quot;</span></span></code></pre></div><h2 id="land-type-validation" tabindex="-1">Land Type Validation <a class="header-anchor" href="#land-type-validation" aria-label="Permalink to &quot;Land Type Validation&quot;">​</a></h2><p>The contract validates land compatibility with building types:</p><h3 id="resource-land" tabindex="-1">Resource Land <a class="header-anchor" href="#resource-land" aria-label="Permalink to &quot;Resource Land&quot;">​</a></h3><ul><li><strong>Valid Buildings</strong>: Only &quot;Mine&quot;</li><li><strong>Factory Requirements</strong>: 5-key schema with ResourceType metadata</li><li><strong>State Requirements</strong>: Must be prospected (have ResourceType set)</li></ul><h3 id="construction-land" tabindex="-1">Construction Land <a class="header-anchor" href="#construction-land" aria-label="Permalink to &quot;Construction Land&quot;">​</a></h3><ul><li><strong>Valid Buildings</strong>: Any except &quot;Mine&quot;</li><li><strong>Factory Requirements</strong>: 3-key schema (BuildingType, ProductionSpeed, BuildingName)</li><li><strong>State Requirements</strong>: Must be unbuilt (no key_values set)</li></ul><h2 id="integration-with-on-chain-data" tabindex="-1">Integration with On-Chain Data <a class="header-anchor" href="#integration-with-on-chain-data" aria-label="Permalink to &quot;Integration with On-Chain Data&quot;">​</a></h2><h3 id="factory-schema-validation" tabindex="-1">Factory Schema Validation <a class="header-anchor" href="#factory-schema-validation" aria-label="Permalink to &quot;Factory Schema Validation&quot;">​</a></h3><p>The contract validates factory schemas match building requirements:</p><h4 id="resource-land-schema-5-keys" tabindex="-1">Resource Land Schema (5 keys): <a class="header-anchor" href="#resource-land-schema-5-keys" aria-label="Permalink to &quot;Resource Land Schema (5 keys):&quot;">​</a></h4><ol><li><strong>BuildingType</strong> (string) - Default: &quot;Unbuilt&quot;</li><li><strong>ResourceType</strong> (string) - Default: &quot;Unprospected&quot;</li><li><strong>ResourceQty</strong> (uint64)</li><li><strong>ProductionSpeed</strong> (uint64)</li><li><strong>StorageCapacity</strong> (uint64)</li></ol><h4 id="construction-land-schema-3-keys" tabindex="-1">Construction Land Schema (3 keys): <a class="header-anchor" href="#construction-land-schema-3-keys" aria-label="Permalink to &quot;Construction Land Schema (3 keys):&quot;">​</a></h4><ol><li><strong>BuildingType</strong> (string) - Default: &quot;Unbuilt&quot;</li><li><strong>ProductionSpeed</strong> (uint64)</li><li><strong>BuildingName</strong> (string)</li></ol><h3 id="metadata-state-management" tabindex="-1">Metadata State Management <a class="header-anchor" href="#metadata-state-management" aria-label="Permalink to &quot;Metadata State Management&quot;">​</a></h3><p>The contract manages complex state transitions:</p><ol><li><strong>Construction Start</strong>: &quot;Unbuilt&quot; → &quot;Unfinished {BuildingType}&quot;</li><li><strong>Construction Complete</strong>: &quot;Unfinished {BuildingType}&quot; → &quot;{BuildingType}&quot;</li></ol><h3 id="json-metadata-updates" tabindex="-1">JSON Metadata Updates <a class="header-anchor" href="#json-metadata-updates" aria-label="Permalink to &quot;JSON Metadata Updates&quot;">​</a></h3><p>Upon construction completion, the contract updates the Uniq&#39;s JSON metadata to reflect the new visual appearance. Metadata keys follow patterns:</p><ul><li><strong>Resource Mines</strong>: &quot;ResourceLand{ResourceType}{BuildingType}&quot;</li><li><strong>Construction Buildings</strong>: &quot;ConstructionLand{BuildingType}&quot;</li></ul><h2 id="fee-management" tabindex="-1">Fee Management <a class="header-anchor" href="#fee-management" aria-label="Permalink to &quot;Fee Management&quot;">​</a></h2><h3 id="multi-asset-payments" tabindex="-1">Multi-Asset Payments <a class="header-anchor" href="#multi-asset-payments" aria-label="Permalink to &quot;Multi-Asset Payments&quot;">​</a></h3><p>The construction system supports complex fee structures requiring multiple asset types:</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Example fee structure for building a Mine</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">building_fee: [</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;4,ASH&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     // 1000 ASH tokens</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;4,IRON&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     // 500 IRON tokens  </span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;4,STONE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     // 200 STONE tokens</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><h3 id="fee-buffering-process" tabindex="-1">Fee Buffering Process <a class="header-anchor" href="#fee-buffering-process" aria-label="Permalink to &quot;Fee Buffering Process&quot;">​</a></h3><ol><li><strong>Accumulation</strong>: Players send assets incrementally</li><li><strong>Validation</strong>: Contract validates each asset type and amount</li><li><strong>Execution</strong>: When all fees collected, operation executes</li><li><strong>Retirement</strong>: Non-ASH tokens retired, ASH sent to vault</li></ol><h3 id="asset-handling" tabindex="-1">Asset Handling <a class="header-anchor" href="#asset-handling" aria-label="Permalink to &quot;Asset Handling&quot;">​</a></h3><ul><li><strong>ASH Tokens</strong>: Transferred to <code>aom.vault</code> as revenue</li><li><strong>Other Tokens</strong>: Transferred to <code>aom.coins</code> for retirement</li></ul><h2 id="cross-contract-integration" tabindex="-1">Cross-Contract Integration <a class="header-anchor" href="#cross-contract-integration" aria-label="Permalink to &quot;Cross-Contract Integration&quot;">​</a></h2><h3 id="mining-contract-integration" tabindex="-1">Mining Contract Integration <a class="header-anchor" href="#mining-contract-integration" aria-label="Permalink to &quot;Mining Contract Integration&quot;">​</a></h3><p>For mine construction:</p><ol><li>Validates resource settings from <code>aom.mining</code></li><li>Sets initial storage capacity based on resource type</li><li>Calls <code>aom.mining::minebuilt</code> to initialize collection timer</li></ol><h3 id="permission-management" tabindex="-1">Permission Management <a class="header-anchor" href="#permission-management" aria-label="Permalink to &quot;Permission Management&quot;">​</a></h3><p>The contract uses specific permissions for cross-contract calls:</p><ul><li><strong>AOM_UNIQS</strong> account for metadata updates</li><li><strong>setvalsa</strong> permission for on-chain data modifications</li><li><strong>settknmeta</strong> permission for JSON metadata updates</li></ul><h2 id="security-considerations" tabindex="-1">Security Considerations <a class="header-anchor" href="#security-considerations" aria-label="Permalink to &quot;Security Considerations&quot;">​</a></h2><ul><li><strong>Ownership Validation</strong>: Strict validation of Uniq ownership</li><li><strong>State Consistency</strong>: Prevents invalid construction on inappropriate land</li><li><strong>Fee Integrity</strong>: Robust validation prevents fee manipulation</li><li><strong>Time Validation</strong>: Ensures construction timers are properly enforced</li><li><strong>Factory Validation</strong>: Validates land factory compatibility</li><li><strong>Emergency Controls</strong>: Contract locking for emergency situations</li></ul>',132),o=[n];function r(l,d,c,h,p,u){return i(),a("div",null,o)}const m=t(e,[["render",r]]);export{k as __pageData,m as default};
